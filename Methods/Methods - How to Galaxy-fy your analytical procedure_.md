# Methods - How to Galaxy-fy your analytical procedure?
Analyses are rarely computed only once. Any analysis with a generalisation potential is a suitable candidate to be Galaxy-fied. This methodological framework is presented at three levels depending on potential interests, computing language skills, and willingness to invest more or less time in the process: (i) ‘user’ relying on existing Galaxy tools and workflows to analyse data (lower time investment), (ii) ‘developer’ relying on existing and validated analytical procedure to develop Galaxy tools and workflows (highest time investment), and (iii) ‘trainer’ relying on existing Galaxy tools to share workflows and create training material (variable time investment). Of course, learning to use a new platform and trying to look differently at analyses is time consuming in the short term, but saves time in the long run. Even if in the end the analysis is not made available on Galaxy, the work is not lost as each step helps the analysis to reach a higher level of good practicebest practice.

## Guidelines “as a user”
Whether one wants to design a new analysis directly on Galaxy or has already an established analytical procedure and wants to adapt it on Galaxy to make it easier to review and reuse, the following steps are approximately the same. As Galaxy already is a workflow-oriented platform with atomisation of steps, “atoms” of the analysis are apparent while building the analysis on Galaxy.
The Galaxy platform offers many options that can be explored using the guided tours of the interface (on the welcome page or tab “Help – Interactive Tours”). Several tutorials are also available on the Galaxy Training Network (https://training.galaxyproject.org) to learn how to use Galaxy (e.g. topics “Introduction to Galaxy Analyses”, “Using Galaxy and Managing your Data”). Main steps of the implementation of an analytical procedure on Galaxy as a user are represented on figure 4.


>Figure 4 - Decision tree and framework for Galaxy users relying on existing tools and workflows. The orange boxes represent actions. The blue boxes represent possible situations one may encounter during the procedure. The red boxes represent steps where one could stop, share the work, and then attain better reproducibility and FAIRness. Letters at the top left of boxes indicate which paragraph it refers to in the text.
Links: (1) https://toolshed.g2.bx.psu.edu (2) https://usegalaxy-eu.github.io/posts/2020/08/22/three-steps-to-galaxify-your-tool 
(3) https://matrix.to (4) https://github.com/galaxyecology

(a)	The first thing to do when starting an analysis on Galaxy is to look for tutorials on the Galaxy Training platform to benefit from others’ experience. One tutorial may be enough to set the tracks for the whole analytical procedure, but it is also possible to use sub-parts of tutorials and/or associate several tutorials to complete steps of the procedure. Numerous ready-to-use workflows are also available on the Galaxy servers (tab “Shared Data – Workflows”) or could be imported from WorkflowHub or Dockstore, one may find one or several workflows to complete its analysis. High-quality peer-reviewed Galaxy workflows are reported by the Intergalactic Workflow Commission (IWC, https://github.com/galaxyproject/iwc). Additionally, it is possible to seek for help by asking on the Matrix channel (https://gitter.im/Galaxy-Training-Network/Lobby) or by opening a topic on the Galaxy Help (https://help.galaxyproject.org).

(b)	If the whole analytical procedure has not been fully covered with available tutorials and workflows, almost 10,000 tools are available on the Galaxy Tool Shed (https://toolshed.g2.bx.psu.edu) to connect the dots. 
(c)	One or several helpful tools might not be installed on the used Galaxy server and one may need to ask for an installation (See box. 1 Ask for tool installation).

> Box 1 - Ask for tool installation. See https://usegalaxy-eu.github.io/posts/2020/08/22/three-steps-to-galaxify-your-tool/ for more details
> ----
> Fork: Act of creating a copy of a repository in one’s personal space 
> Commit: Act of submitting a modification to a file
> Pull Request (PR): Act of proposing one or several Commit(s) to be integrated
> Merge: Act of accepting the PR and integrate the modification proposed on the repository
> ----
> Galaxy tools installation process is accessible to anyone, it is often explained directly in the “Read me” file on the server tools repository (usually on GitHub or GitLab). To ask for the installation of a tool one must:
>-	Look for the tool repository on the Galaxy Tool Shed;
>-	Look for the domain tools repository (e.g. https://github.com/usegalaxy-eu/usegalaxy-eu-tools for all Galaxy Europe servers; https://gitlab.com/ifb-elixirfr/usegalaxy-fr/tools for Galaxy France);
>-	Fork this repository and look for the .yaml file corresponding to the used server (e.g. ecology.yaml for the https://ecology.usegalaxy.eu and https://ecology.usegalaxy.fr servers);
>-	In the .yaml file, make a Commit to add the following lines with the name and owner of the tool (written on the tool repository on the Galaxy Tool Shed) along with a suggested tool panel section in which the tool can be sorted: 
>``` 
>name: pampa_presabs
>owner: ecology
>tool_panel_section_label: 'Species abundance' 
>```
>-	PR the modification on the domain tools repository and wait for server maintainers’ approval (merge) and/or suggestions. The installation of tools might be rejected if the peer-review process or relevance of the proposed tool is not adequate in the server maintainers’ opinion.

If there are still gaps in the analytical procedure that none of the existing tools can fill, several options are available:
- (d)	Ask for help (see end of bullet a).
- (e)	Temporarily fill the gap with a command-line code locally or through a Galaxy Interactive Tool (e.g. Rstudio, Jupyter notebook and Ubuntu desktop interactive tools). The code can be shared or not.
- (f)	Propose a new tool by sharing the idea through a GitHub issue (https://github.com/galaxyecology; preferably along with a code if existing). Details on the task aimed and awaited input and output (i.e. full specifications) of the tool along with references are of great help for potential developers who may take over tool development. If one wants to try tool development, see section ‘As a developer’.

(g)	Through these steps of looking for tutorials, workflows, and tools, the analytical procedure is progressively designed on the Galaxy history. As each Galaxy tool, parametrisation and provenance of each file produced is tracked in the Galaxy history, one can try several tools with different parameters to compare and find out which configuration seems the best. The Galaxy history can be shared to anyone through a link to collaborate on the analysis or in a peer-review process. 

(h)	When parametrisation stage is done and the analytical procedure is complete, one can extract a workflow to reuse the analytical procedure on new datasets. 

(i)	In the case of a missing tool and part of the analytical procedure is temporarily performed outside Galaxy, one can build separate workflows, between which data is downloaded to make required steps locally. A better temporary solution is to program the launch of Galaxy Interactive Tools (e.g. Posit (R), Jupyter notebooks, and Ubuntu desktop interactive tools) in the workflow to keep most of the procedure on Galaxy. In this case, provenance tracking can be secured partially by saving created objects, command history (e.g. Rhistory), and running environment for example.

(j)	Extracted workflow(s) can be shared with others for feedback or collaboration, but it can also be shared publicly on Galaxy server(s) and/or integrated to an article. When starting to share openly workflow(s), one is a Galaxy contributor as well as a user (see section “As a trainer”). 

## Guidelines “as a developer” 
Developing Galaxy tools requires time investment, especially at the beginning to understand how Galaxy works and the architecture of the tools. The development procedure can vary depending on the origin of the analytical workflow idea which can be (i) existing code, a package, or a workflow implemented elsewhere, (ii) an idea from a user proposal, (iii) a published article or a personal need, and even (iv) an analytical procedure using originally several interfaced tools. When an analytical procedure was originally designed with atomisation and generalisation of elementary steps in mind, the process of developing Galaxy tools should take a lot less time. Main steps of the implementation of an analytical procedure on Galaxy as a developer are represented on figure 5.
 
> Figure 5 - Decision tree and framework for Galaxy developers. Orange boxes represent actions, blue boxes represent possible situations one may encounter during the process and red boxes represent shareable steps where one could stop and still attain better reproducibility and FAIRness. Letters at the top left of boxes indicate which paragraph it refers to in the text.
> Links: (1) https://toolshed.g2.bx.psu.edu (2) https://usegalaxy-eu.github.io/posts/2020/08/22/three-steps-to-galaxify-your-tool 
> (3) https://github.com/galaxyecology 
> (4) https://planemo.readthedocs.io/en/latest/index.html 
> (5) https://docs.galaxyproject.org/en/latest/dev/schema.html 
> (6) https://planemo.readthedocs.io/en/latest/index.html

(a)	The atomisation process starts at early stage of the design of an analytical workflow before writing any computer code. Atomisation into elementary steps provides clarity to the development phases. Ultimately, one elementary step equals one Galaxy tool and the modular parameters identified in the code for generalisation would be those that appear on the tool interface. 

(b)	One can start by splitting essential steps of the analysis (e.g. pre-processing, analyses, representations) and detailing each elementary step afterward to get different atomisation resolutions (tab. 1; fig. 1). The first atomisation is not a permanent choice and will certainly be refined over the course of the development process. It is mainly useful as a medium for researchers and other scientists to give feedback on the projected architecture of the workflow and to have an overview of the analytical procedure. As for any analysis, one must check if potential issues or red flags were raised by the community on the methods used and take it into account in the architecture of the workflow. At this point, any products generated from the atomisation process can be shared and be useful to the scientific community. For example, sharing a written description or a schematic representation of the steps and organisation of an analytical procedure (coded or not) is a valuable help for anyone trying to make a similar analysis. 

\(c\)	As a user would do and before starting tool development, one must look for existing tools on Galaxy servers and Galaxy ToolShed (https://toolshed.g2.bx.psu.edu) to avoid redundancy. If all needed tools are available, one can directly build their workflow on Galaxy, see ‘As a user’ section. Many tools are available on Galaxy for data manipulation. If one needs a particular format or type of data there is high probability that it can already be handled on Galaxy. 

(d)	If some tools could work in the workflow, one must test it to see if and how it can be integrated. 

(e)	In the case some tools are not installed on the Galaxy server, ask for tool installation (see box.1) 

(f)	Selected tools might not integrate precisely as aimed, if the input or the output is not formatted as projected in the primary workflow design, other tools added before and/or after might solve the problem. If such tools are not available or the problem is more about a missing parameter or methodology, it might be more coherent to modify existing tool(s) than developing entirely new ones. One can open a new GitHub issue to ask for modifications on the tool repository (found on the Galaxy ToolShed) or directly suggest modifications on the tool. When modifying a tool, the process is approximately the same as for developing an entirely new tool (explained in the next paragraph) only the Pull Request for modifications should be opened on the tool repository.

(g)	The Galaxy community has made available a lot of documentation resources for tool development on the GTN Training platform (category “Development in Galaxy”; https://training.galaxyproject.org/training-material/topics/dev) and on the General Galaxy documentation (https://docs.galaxyproject.org; https://docs.galaxyproject.org/en/latest/dev/schema.html). 

Galaxy tools have a common architecture (fig. 6). Each tool consists of an XML (Extensible Markup Language) wrapper which defines input file(s) and parameters that are presented to the end-user in the Galaxy web interface ("ToolName.xml" in fig. 6). Inputs provided through the interface can be processed with code in any computing language (“ExeToolName.r” in fig. 6). Outputs of the code are also specified in the XML file and are made available to the user in the Galaxy history at the end of the computation.
 
> Figure 6 - Schematic representation of the simplified architecture of an example Galaxy tool using R language. From the input files and parameters provided by the user, the tool will launch an analytical procedure through the XML and R files to produce the outputs.

At least one unit test is mandatory to make sure a tool works and produces the expected outputs. This also facilitates maintenance, as tests will indicate if the functionality is preserved after tool updates. To do so, the test is written in the XML file with all parameter settings, input and expected output files (stored in a sub-directory “test-data”) or characteristics of the expected output.

This organisation can be more elaborate, especially when developing several tools at the same time. For example, parts of XML files may repeat themselves in the different tools and one can create a supplementary XML file to write this repeating part once as a macro and call (‘expand’) it as needed, which saves time and space. The same type of repeating patterns can occur in the computing code and one should create a functions file to avoid copy-pasting of many lines in several separate code files.

Detailed documentation of the XML wrapper files is available in Galaxy, see https://docs.galaxyproject.org/en/master/dev/schema.html, as well as tutorials (https://gxy.io/GTN:T00117). An empty Galaxy tool template in R language is available in the following repository: https://github.com/ColineRoyaux/Galaxy_Templates/tree/main/R_Tool_template.

(h)	To begin development, it is best to have knowledge of the required informatics dependencies of the tool(s) such as software versions, packages and their versions to directly check their availability on Conda Forge (https://conda-forge.org/feedstock-outputs). 

(i)	Some dependencies might not be available, and, in this case, one must write and propose a recipe to the Conda Forge on GitHub (https://github.com/conda-forge), for guidelines see https://conda-forge.org/#add_recipe. For Python and R packages available on Pypi or CRAN respectively, helper codes are available to automatically generate recipes, see https://github.com/conda/grayskull and https://github.com/bgruening/conda_r_skeleton_helper (by B. Grüning), respectively. Dependencies of the Galaxy tools are called in the XML file.

(j)	Generalisation of computational code is especially important while developing the Galaxy tool to make sure the tool is useful to the largest audience. It is difficult to think about all possible purposes of a tool, one will likely miss some aspects but as Galaxy is a participative platform, anyone can ask for modifications or make it themselves. The format of the input file is a critical aspect of developing a Galaxy tool, while other aspects of the format can be left to the users’ choice or imposed. For example, on Galaxy, the preferred format for table input is tab-separated values (TSV or “tabular”). Many tools on Galaxy are available to convert file formats (e.g. from CSV to tabular). 

For example, a typical choice to make as a developer when developing a tool dealing with tables is to ask the user to specify through the interface which column contains a specific variable, or to require a column name to be present in the input file for the tool to find the variable. The first option is more generalised as it is easier for the user to select a column directly on the interface rather than change column names in the data files. The second option can however be chosen when the tool uses a lot of columns in different input tables or has a lot of intricate parameters to avoid unnecessary complexity of the tool interface. This option can also be consistent for tools using input data file written in a standardised way, as Darwin-core data standard for example.

Depending on the type of manipulations and analyses made in the tool, many parameters might be useful for users to customise such as the type of model, the distribution law of the data, the corrections to make on the data, the level of resolution or the type and format of output(s). Prior discussions on the workflow with experts and researchers on the analytical procedure can permit to raise important parameters for the users to set. Another good way to get a view on what kind of parameters can be useful for users is to check directly for parameters in the functions used in the computational code and identify which ones are important for the computation and might be critical for users to set. These parameters can be provided with default values if the user does not provide a custom value. An “advanced parameters” collapsible section can also be implemented to keep the interface simple while still permitting flexibility for experimented users. Finally, to check if a workflow is properly generalised, one can seek input files of different origins from open data repositories or ask scientists to test their tools.

It is impossible to prevent all possible misuses of software and such events occur also when using command-line functions. Implementation of error and warning messages in the computing code is the best way to avoid misuse (e.g. wrong input format or parameter selection). One can also use the interface, the help section of tools, and training to help users to set parameters properly and raise red flags on the use of tools and workflows (e.g. the tool cannot be used on some types of data, types of modelling interact badly with some parameters settings or data distributions). If possible, implementing verification steps in the tools to give feedback to the user on how the computation went is also a good way for the user to get hindsight on the results (e.g. quantity of data that couldn’t be used in the tool, models’ evaluation variables, summary plots).

(k)	To verify tools syntax (lint), run unitary tests (test), and deploy a local Galaxy server to test tools interface (serve), one must use Planemo, the Galaxy Software Development Kit (Bray et al., 2023). Planemo is a command–line tool used on a Linux environment (see documentation https://planemo.readthedocs.io/en/latest. For Windows users, Planemo can work on a WSL (Windows Subsystem for Linux) or using cloud development environment like GitPod. Galaxy Tool development can take many forms; the computational code can be developed beforehand on the local environment or, together with the XML file and be tested directly through a local interface deployed for testing. Each strategy has different pros and cons depending on the type of analytical procedure, the origin of the workflow, and the developer personal preference and knowledge.

(l)	When ready, tool(s) can be proposed to a collaborative Galaxy tool repository (for ecology: https://github.com/galaxyecology/tools-ecology; see box. 2 for procedure on GitHub) for peer-review by the community.
> Box 2 - Definitions of Git terminology and procedure for proposing a tool to a Galaxy repository
> ----
> Fork: Act of creating a copy of a repository in one’s personal space 
> Commit: Act of submitting a modification to a file
> Pull Request (PR): Act of proposing one or several Commit(s) to be integrated
> Merge: Act of accepting the PR and integrate the modification proposed on the repository
> ----
> One has to fork the repository to add their new tool with a Commit and propose a PR against the original Galaxy repository with a brief description of the aims of developed tool(s) (PR example: https://github.com/galaxyecology/tools-ecology/pull/50). When a PR is opened on the repository, verification (“Check jobs”) of the tool(s) compatibility, syntax, development best practices and proper running are made automatically. If there are problems, one can check output logs of what went badly and try to correct it while scientists invested in the Galaxy community give feedback on the tool(s). When checks are finally passed and code is peer-reviewed by the community, the PR is merged and the tool(s) made available on the Galaxy ToolShed within a few days. One may then ask for tool installation on any server (see box. 1 Ask for tool installation).

(m) Once all developed tools are available on the Galaxy server, one can build a workflow as a user would do, share it and eventually write a training on the use of the workflow, see section “as a trainer”.

## Guidelines “as a trainer”
Main steps of the implementation of an analytical procedure on Galaxy as a trainer are represented on figure 7.
 
> Figure 7 - Decision tree and framework for Galaxy trainers. Orange boxes represent actions, blue boxes represent possible situations one may encounter during the process and red boxes represent shareable steps where one could stop and still attain better reproducibility and FAIRness. Letters at the top left of boxes indicate which paragraph it refers to in the text.
> Links: (1) https://training.galaxyproject.org/training-material/topics/contributing/tutorials/create-new-tutorial/tutorial.html (2) https://training.galaxyproject.org/training-material/topics/contributing/tutorials/create-new-tutorial/tutorial.html#create-the-skeleton-of-the-tutorial

(a)	When an analytical procedure is built on Galaxy, one can extract a workflow from the history created. This workflow can be modified afterward to add annotations, comments, and flags. To make their workflow more generalised, one can leave parameters empty and users will have to set these parameters each time the workflow is launched. This workflow can be shared to contribute to Galaxy. Ultimately, it could be submitted to IWC and be made available on WorkflowHub and/or Dockstore.

(b)	Eventually, one can write a tutorial on the GTN or a blog post on the Galaxy Community Hub to get better visibility and broadcast valuable elements on the use of the workflow. GTN tutorials are written in markdown. One can start from scratch, but it is easier to start from a template generated from an existing Galaxy workflow using the dedicated webserver (https://ptdk.apps.galaxyproject.eu) or the command-line software Planemo (documentation: https://planemo.readthedocs.io/en/latest). Indeed, this approach only requires adding any needed explanations between the auto-generate “hands-on” boxes containing tools and parameters instructions. Many tutorials explain the different ways to contribute to the GTN (e.g. tutorials, slides, videos, training sessions, quizzes) in the contributing topic on the GTN: https://training.galaxyproject.org/training-material/topics/contributing Introduction on the creation of a new hands-on tutorial is detailed in this tutorial: https://training.galaxyproject.org/training-material/topics/contributing/tutorials/create-new-tutorial/tutorial.html. Like tools, contributions to Galaxy Training Material are proposed through GitHub (https://github.com/galaxyproject/training-material). Available tutorials are publicly and freely available and can be openly shared to colleagues and students and be used during courses and training sessions.

